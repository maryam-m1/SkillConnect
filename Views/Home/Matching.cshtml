@{
    ViewData["Title"] = "Euclidean Matching";
}

<div id="matchingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="z-index: 10000; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);">
    <div class="text-center text-white">
        <div class="spinner-border text-primary mb-4" style="width: 4rem; height: 4rem;" role="status"></div>
        <h2 class="display-6 fw-bold mb-2">Connecting to Engine...</h2>
        <p id="statusUpdate" class="lead text-info">Initializing Neural Pathways</p>
    </div>
</div>

<div class="matching-page-wrapper">
    <div class="full-screen-bg"></div>

    <div class="container animate__animated animate__fadeInUp position-relative main-content-shift" style="z-index: 2;">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-primary">Euclidean Matching Engine</h1>
            <p class="lead text-muted">Precision career mapping using spatial mathematics.</p>
        </div>

        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="p-4 bg-white shadow rounded-4 border-top border-primary border-4 h-100 transition-hover">
                    <img src="/images/EuclideanMath.jpeg" class="mb-3 rounded w-100 shadow-sm" alt="Mapping" style="height: 180px; object-fit: cover;">
                    <h4 class="fw-bold">1. Profile Mapping</h4>
                    <p class="text-muted small">Converting scores into a 6D mathematical vector representing your skill DNA.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-4 bg-white shadow rounded-4 border-top border-primary border-4 h-100 transition-hover">
                    <img src="/images/distance.jpeg" class="mb-3 rounded w-100 shadow-sm" alt="Distance" style="height: 180px; object-fit: cover;">
                    <h4 class="fw-bold">2. Distance Check</h4>
                    <p class="text-muted small">Calculating the multi-dimensional gap between your vector and 50+ career roles.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-4 bg-white shadow rounded-4 border-top border-primary border-4 h-100 transition-hover">
                    <img src="/images/career.jpeg" class="mb-3 rounded w-100 shadow-sm" alt="Match" style="height: 180px; object-fit: cover;">
                    <h4 class="fw-bold">3. Career Alignment</h4>
                    <p class="text-muted small">The role with the mathematically shortest distance is identified as your ideal match.</p>
                </div>
            </div>
        </div>

        <div class="mt-5 p-5 rounded-5 text-center shadow-lg formula-container">
            <h3 class="fw-bold mb-4 text-dark">The Distance Formula</h3>
            
            <div class="py-2">
                <div class="formula-bg-wrapper d-inline-block">
                    <img src="/images/formula.png" alt="Euclidean Formula" 
                         style="max-width: 350px;" 
                         class="img-fluid mb-4">
                </div>
            </div>

            <div>
                <a asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg rounded-pill px-5 fw-bold mt-2 shadow">
                    <i class="fas fa-home me-2"></i> Back to Home
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    header, nav { position: relative; z-index: 9999 !important; }

    .matching-page-wrapper {
        position: relative;
        min-height: 100vh;
        width: 100%;
        background: transparent !important;
        margin-top: -20px; 
    }

    .main-content-shift { padding-top: 60px; padding-bottom: 60px; }

    .full-screen-bg {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background-image: url('/images/1196354-3840x2160-desktop-4k-geometry-background-image.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        z-index: -999 !important; 
    }

    .transition-hover { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .transition-hover:hover {
        transform: translateY(-15px);
        box-shadow: 0 15px 40px rgba(13, 110, 253, 0.2) !important;
    }

    .formula-container {
        background: linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.3)), 
                    url('/images/brain-bulb-idea-conceptual-image-showing-light-inside-representing-creativity-innovation-391842723.webp');
        background-size: cover;
        border: 1px solid rgba(0, 123, 255, 0.2);
        z-index: 2;
    }

    .formula-bg-wrapper { background: rgba(255, 255, 255, 0.85); padding: 25px; border-radius: 20px; }
</style>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/matchingHub")
            .build();

        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected.");
                runMatchingAnimation();
            } catch (err) {
                console.log(err);
                setTimeout(start, 5000);
            }
        };

        function runMatchingAnimation() {
            const statusText = document.getElementById("statusUpdate");
            const overlay = document.getElementById("matchingOverlay");
            
            const steps = [
                "📡 Establishing Connection to Skill-Cloud...",
                "🧬 Mapping 6-Dimensional DNA...",
                "📐 Calculating Euclidean Distances...",
                "✅ Synchronization Complete!"
            ];

            let count = 0;
            const interval = setInterval(() => {
                if (count < steps.length) {
                    statusText.innerText = steps[count];
                    count++;
                } else {
                    clearInterval(interval);
                    // Overlay ko fade out karke asli content dikhana
                    overlay.style.transition = "opacity 1s ease";
                    overlay.style.opacity = "0";
                    setTimeout(() => overlay.remove(), 1000);
                }
            }, 1500);
        }

        start();
    </script>
}